<script setup>
import { verify } from '@/apis/auth'
import { StatusCodes } from '@/constants/status-code'
import { getLoading } from '@/utils/el-loading'
import { onMounted, ref } from 'vue'
import { RouterLink, useRouter } from 'vue-router'

const router = useRouter()
const email = router.currentRoute.value.query.email
const token = router.currentRoute.value.query.token
let verifyStatus = ref(-1)
let errorMessage = ref('')

const handleVerify = async () => {
  let loading
  try {
    loading = getLoading()
    const res = await verify({ email: email, token: token })
    if (res.status === StatusCodes.OK) {
      verifyStatus.value = 1
      return
    }
  } catch (error) {
    console.log(error)
    // errorMessage.value = error?.response?.data?.message
    verifyStatus.value = 0
  } finally {
    loading.close()
  }
}

onMounted(async () => {
  handleVerify()
})
</script>
<template>
  <div
    class="h-screen w-screen flex items-center justify-center bg-gradient-to-br from-sky-100 via-blue-50 to-white font-sans"
  >
    <!-- Card success -->
    <div
      v-if="verifyStatus === 1"
      class="bg-white rounded-xl shadow-lg w-full max-w-md p-8 text-center"
    >
      <!-- Logo -->
      <div class="mb-6">
        <svg width="150px" class="mx-auto mb-5" viewBox="0 0 113 32">
          <path
            fill="var(--text-color, #1e1f21)"
            d="M104.97 25.64c-4.6 0-7.3-3.4-7.3-8s2.7-7.94 7.3-7.94c4.57 0 7.24 3.34 7.24 7.94s-2.67 8-7.24 8m0-13.49c-3.28 0-4.72 2.58-4.72 5.49s1.44 5.55 4.72 5.55c3.25 0 4.66-2.64 4.66-5.55s-1.41-5.49-4.66-5.49M96.21 25.3c-.21.06-.67.12-1.35.12-2.51 0-4.11-1.19-4.11-4.02V3.59h2.64V21.1c0 1.38.92 1.87 2.06 1.87.28 0 .46 0 .77-.03zm-8 0c-.21.06-.67.12-1.35.12-2.51 0-4.11-1.19-4.11-4.02V3.59h2.64V21.1c0 1.38.92 1.87 2.06 1.87.28 0 .46 0 .77-.03zM72.86 12.09c-2.79 0-4.2 1.81-4.48 4.48h8.56c-.15-2.85-1.44-4.48-4.08-4.48m5.89 12.64c-1.26.67-3.19.92-4.75.92-5.73 0-8.25-3.31-8.25-8 0-4.63 2.58-7.94 7.24-7.94 4.72 0 6.62 3.28 6.62 7.94v1.2H68.42c.37 2.61 2.05 4.29 5.67 4.29 1.78 0 3.28-.34 4.66-.83zm-19.48-8.44v9.05h-2.58V10h2.58v2.7c.89-1.81 2.42-3.1 5.43-2.91v2.58c-3.37-.34-5.43.67-5.43 3.93M40.28 5.19h15.09v2.64H49.2v17.51h-2.76V7.82h-6.16z"
          ></path>
          <path
            fill="var(--tile-color,#1558bc)"
            d="M0 8a8 8 0 0 1 8-8h16a8 8 0 0 1 8 8v16a8 8 0 0 1-8 8H8a8 8 0 0 1-8-8z"
          ></path>
          <path
            fill="var(--icon-color, white)"
            d="M12.9 24c.62 0 1.13-.49 1.13-1.1V9.1c0-.61-.5-1.1-1.13-1.1H8.13C7.51 8 7 8.49 7 9.1v13.8c0 .61.5 1.1 1.13 1.1zm10.97-6.34c.62 0 1.13-.49 1.13-1.1V9.1c0-.61-.5-1.1-1.13-1.1H19.1c-.62 0-1.13.49-1.13 1.1v7.47c0 .61.5 1.1 1.13 1.1z"
          ></path>
        </svg>
      </div>

      <!-- Title -->
      <h1 class="text-2xl font-semibold text-gray-800 mb-2">Xác nhận địa chỉ email thành công</h1>
      <p class="text-gray-500 mb-6">Nhấn nút bên dưới để chuyển sang màn hình đăng nhập.</p>

      <!-- Action Button -->

      <RouterLink to="/login" class="decoration-1 underline text-blue-600 text-xs"
        >Về trang đăng nhập</RouterLink
      >
    </div>

    <!-- Card fail -->
    <div
      v-if="verifyStatus === 0"
      class="bg-white rounded-xl shadow-lg w-full max-w-md p-8 text-center"
    >
      <!-- Logo -->
      <div class="mb-6">
        <svg width="150px" class="mx-auto mb-5" viewBox="0 0 113 32">
          <path
            fill="var(--text-color, #1e1f21)"
            d="M104.97 25.64c-4.6 0-7.3-3.4-7.3-8s2.7-7.94 7.3-7.94c4.57 0 7.24 3.34 7.24 7.94s-2.67 8-7.24 8m0-13.49c-3.28 0-4.72 2.58-4.72 5.49s1.44 5.55 4.72 5.55c3.25 0 4.66-2.64 4.66-5.55s-1.41-5.49-4.66-5.49M96.21 25.3c-.21.06-.67.12-1.35.12-2.51 0-4.11-1.19-4.11-4.02V3.59h2.64V21.1c0 1.38.92 1.87 2.06 1.87.28 0 .46 0 .77-.03zm-8 0c-.21.06-.67.12-1.35.12-2.51 0-4.11-1.19-4.11-4.02V3.59h2.64V21.1c0 1.38.92 1.87 2.06 1.87.28 0 .46 0 .77-.03zM72.86 12.09c-2.79 0-4.2 1.81-4.48 4.48h8.56c-.15-2.85-1.44-4.48-4.08-4.48m5.89 12.64c-1.26.67-3.19.92-4.75.92-5.73 0-8.25-3.31-8.25-8 0-4.63 2.58-7.94 7.24-7.94 4.72 0 6.62 3.28 6.62 7.94v1.2H68.42c.37 2.61 2.05 4.29 5.67 4.29 1.78 0 3.28-.34 4.66-.83zm-19.48-8.44v9.05h-2.58V10h2.58v2.7c.89-1.81 2.42-3.1 5.43-2.91v2.58c-3.37-.34-5.43.67-5.43 3.93M40.28 5.19h15.09v2.64H49.2v17.51h-2.76V7.82h-6.16z"
          ></path>
          <path
            fill="var(--tile-color,#1558bc)"
            d="M0 8a8 8 0 0 1 8-8h16a8 8 0 0 1 8 8v16a8 8 0 0 1-8 8H8a8 8 0 0 1-8-8z"
          ></path>
          <path
            fill="var(--icon-color, white)"
            d="M12.9 24c.62 0 1.13-.49 1.13-1.1V9.1c0-.61-.5-1.1-1.13-1.1H8.13C7.51 8 7 8.49 7 9.1v13.8c0 .61.5 1.1 1.13 1.1zm10.97-6.34c.62 0 1.13-.49 1.13-1.1V9.1c0-.61-.5-1.1-1.13-1.1H19.1c-.62 0-1.13.49-1.13 1.1v7.47c0 .61.5 1.1 1.13 1.1z"
          ></path>
        </svg>
      </div>

      <!-- Title -->
      <h1 class="text-2xl font-semibold text-red-700 mb-2">Xác nhận địa chỉ email thất bại</h1>
      <!-- <p class="text-red-500 mb-6">{{ errorMessage }}</p> -->
      <p class="text-gray-500 mb-6">Nhấn nút bên dưới để thử lại.</p>

      <!-- Action Button -->
      <button
        @click="handleVerify"
        class="bg-blue-600 text-white w-full p-1.5 py-2 mb-4 rounded-xs font-medium text-sm"
      >
        Xác minh email
      </button>
      <RouterLink to="/signup" class="decoration-1 underline text-blue-600 text-xs"
        >Về trang đăng ký&nbsp;&nbsp;</RouterLink
      >
    </div>

    <!-- Card fail -->
    <div
      v-if="verifyStatus === -1"
      class="bg-white rounded-xl shadow-lg w-full max-w-md p-8 text-center"
    >
      <el-skeleton :rows="5" animated />
    </div>
  </div>
</template>
<style scoped>
button {
  cursor: pointer;
}
</style>
